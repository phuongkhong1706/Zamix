class TeacherDetailTestView(APIView):
    permission_classes = [AllowAny]

    def get(self, request, id):
        try:
            print(f"ğŸ” GET yÃªu cáº§u chi tiáº¿t Ä‘á» thi ID = {id}")

            # XÃ¡c thá»±c ngÆ°á»i dÃ¹ng
            user, error_response = get_authenticated_user(request)
            if error_response:
                print("âŒ Lá»—i xÃ¡c thá»±c token:", error_response.content.decode())
                return error_response

            # Láº¥y Ä‘á» thi
            test = get_object_or_404(Test, test_id=id)

            # Kiá»ƒm tra quyá»n truy cáº­p
            if not test.shift:
                return Response(
                    {"message": "Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p Ä‘á» thi nÃ y."},
                    status=status.HTTP_403_FORBIDDEN,
                )

            # Serialize Ä‘á» thi + cÃ¢u há»i + Ä‘Ã¡p Ã¡n
            serialized = TestSerializer(test)
            print("âœ… Tráº£ vá» dá»¯ liá»‡u Ä‘á» thi vÃ  cÃ¢u há»i:", serialized.data)
            return Response(serialized.data, status=status.HTTP_200_OK)

        except Exception as e:
            print("âŒ Lá»—i báº¥t ngá» trong GET Ä‘á» thi:")
            traceback.print_exc()
            return Response(
                {"message": "Internal Server Error", "detail": str(e)},
                status=status.HTTP_500_INTERNAL_SERVER_ERROR,
            )

    def put(self, request, id):
        try:
            print(f"âœï¸ PUT cáº­p nháº­t Ä‘á» thi ID = {id}")

            # XÃ¡c thá»±c ngÆ°á»i dÃ¹ng
            user, error_response = get_authenticated_user(request)
            if error_response:
                print("âŒ Lá»—i xÃ¡c thá»±c token:", error_response.content.decode())
                return error_response

            # Láº¥y Ä‘á» thi
            test = get_object_or_404(Test, test_id=id)

            # Kiá»ƒm tra quyá»n cáº­p nháº­t: Ä‘á» thi -> ca thi -> ká»³ thi -> user
            if not test.shift:
                return Response(
                    {"message": "Báº¡n khÃ´ng cÃ³ quyá»n cáº­p nháº­t Ä‘á» thi nÃ y."},
                    status=status.HTTP_403_FORBIDDEN,
                )

            # Dá»¯ liá»‡u tá»« request
            data = request.data
            print("ğŸ“¥ Dá»¯ liá»‡u cáº­p nháº­t:", data)

            # Cáº­p nháº­t thÃ´ng tin Ä‘á» thi
            test.name = data.get('name', test.name)
            test.type = data.get('type', test.type)
            test.duration_minutes = data.get('duration_minutes', test.duration_minutes)
            test.save()

            # Serialize vÃ  tráº£ vá»
            serialized = TestSerializer(test)
            print("âœ… Cáº­p nháº­t thÃ nh cÃ´ng:", serialized.data)
            return Response(serialized.data, status=status.HTTP_200_OK)

        except Exception as e:
            print("âŒ Lá»—i báº¥t ngá» trong PUT Ä‘á» thi:")
            traceback.print_exc()
            return Response(
                {"message": "Internal Server Error", "detail": str(e)},
                status=status.HTTP_500_INTERNAL_SERVER_ERROR,
            )